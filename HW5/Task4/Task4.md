# 1.6*

> Все расчеты находятся в файле [Task4.ipynb](/HW5/Task4/Task4.ipynb)

## Исследование интерполяции функции $\cosh(2x)$

Целью является исследование поведения погрешности полиномиальной интерполяции функции $f(x) = \cosh(2x)$ на отрезке $[1, 3]$.

Основные задачи:
1. Сравнить интерполяцию на **равномерной сетке** и на **сетке Чебышева**.
2. Исследовать влияние точности вычислений: **Float (32-bit)** vs **Double (64-bit)**.
3. Сравнить экспериментальную ошибку с теоретической оценкой, включающей ошибку метода (усечения) и ошибку округления.

## Теория

Интерполяционный многочлен Лагранжа $L_n(x)$ степени $n$, построенный по узлам $x_0, \dots, x_n$, определяется как:

$$ L_n(x) = \sum_{i=0}^{n} y_i l_i(x), \quad \text{где } l_i(x) = \prod_{j=0, j \neq i}^{n} \frac{x - x_j}{x_i - x_j} $$

### Полная ошибка интерполяции
При реализации на компьютере полная ошибка складывается из двух компонент:

$$ E_{total} \approx E_{truncation} + E_{rounding} $$

#### Ошибка метода (Truncation)
Это математическая погрешность замены функции полиномом.

$$ |f(x) - L_n(x)| \le \frac{M_{n+1}}{(n+1)!} |\omega_n(x)| $$

где:
* $M_n = \max_{x \in [a,b]} |f^{(n)}(x)|$ — максимум $n$-й производной. Для $\cosh(2x)$ это $2^n \cosh(2x)$ (или $2^n \sinh(2x)$).
* $\omega_n(x) = \prod_{i=1}^n (x - x_i)$

#### Ошибка округления (Rounding)
Возникает из-за неточности представления чисел. Она зависит от машинного точности $\varepsilon$ и константы Лебега $\Lambda_n$.

$$ E_{rounding} \approx \varepsilon \cdot \Lambda_n \cdot \max|f(x)| $$

**Константа Лебега** определяется как максимум функции Лебега на отрезке:

$$ \Lambda_n = \max_{x \in [a, b]} \sum_{i=0}^n |l_i(x)| $$

Она показывает, во сколько раз возрастает ошибка входных данных или округления при интерполяции.

### Аналитический расчет

#### Ошибка метода:

$$g(x) = cosh(2x), \quad x \in [1, 3]$$

$$ E_{trunc}=|f(x) - L_n(x)| \le \frac{M_{n+1}}{(n+1)!} |\omega_n(x)| $$

$$
\begin{align*}
g(x) &= \cosh(2x) \\
g^{(k)}(x) &= 2^k \cosh(2x)
\end{align*}
$$
$g(x)$ монотонно возрастает, тогда максимум производной будет в точке $x=3$

$$
M_{n+1} = \max_{x \in [1,3]} |g^{(n+1)}(x)| = 2^{n+1} cosh(6)
$$

**Для равномерной сетки**

Для равномерной сетки на $[a,b]$ с $n+1$ узлом:
$$
\max_{x \in [a,b]} \left|\prod_{i=0}^n (x - x_i)\right| \leq \frac{h^{n+1}}{4} \cdot n!
$$
где $h = \frac{b-a}{n}$ - шаг сетки.

$$
\max \left|\prod_{i=0}^n (x - x_i)\right| \leq \frac{1}{4} \cdot \left(\frac{2}{n}\right)^{n+1} \cdot n!
$$

Тогда получим итоговую оценку для равномерной сетки:

$$
\begin{aligned}
E_{trunc} 
&\leq \frac{2^{n+1}\cosh(6)}{(n+1)!} \cdot \frac{1}{4} \cdot \left(\frac{2}{n}\right)^{n+1} \cdot n! \\[6pt]
&= \frac{\cosh(6)}{4}\frac{2^{n+1}\left(\frac{2}{n}\right)^{n+1} n!}{(n+1)!} \\[6pt]
&= \frac{\cosh(6)}{4}\frac{\left(\frac{4}{n}\right)^{n+1} n!}{(n+1)!} \\[6pt]
&= \frac{\cosh(6)}{4}\frac{1}{n+1}\left(\frac{4}{n}\right)^{n+1} \\[6pt]
&= \cosh(6)\frac{4^{n}}{(n+1)n^{n+1}}.
\end{aligned}
$$

$$
\boxed{E_{trunc} \leq \cosh(6)\frac{4^{n}}{(n+1)n^{n+1}}}
$$

**Для чебышевской сетки**

Для чебышевской сетки на $[a,b]$:

$$
\max_{x \in [a,b]} |\prod\limits_{i=0}^n (x - x_i))| \leq \frac{(b-a)^{n+1}}{2^{2n+1}}
$$

$$
\max |\prod\limits_{i=0}^n (x - x_i))| \leq \frac{2^{n+1}}{2^{2n+1}} = \frac{1}{2^n}
$$

Получим итоговую оценку для чебышевской сетки

$$
\begin{aligned}
E_{trunc} 
&\leq \frac{2^{n+1}\cosh(6)}{(n+1)!} \cdot \frac{1}{2^n}  \\[6pt]
&= \frac{2\cosh(6)}{(n+1)!}
\end{aligned}
$$

$$
\boxed{E_{trunc} \leq \frac{2\cosh(6)}{(n+1)!}}
$$

#### Ошибка округления

$$
E_{round} \leq M_0 \cdot \varepsilon \cdot \Lambda_n
$$

$M_0 = \max\limits_{x \in [1,3]} |g(x)| = cosh(6)$, $\varepsilon$ - машинная точность $\Lambda_n$ - константа Лебега.

Для равномерной сетки:
$$
\Lambda_n \sim \frac{2^{n+1}}{n \log n} \quad \text{при } n \to \infty
$$

Для чебышевской сетки:
$$
 \Lambda_n < \frac{2}{\pi} \log(n+1) + 1
$$

Итого видим, что чебышевская сетка дет значительно лучший результат

## Ход решения


### Генерация сеток (`get_nodes`)
В коде реализованы два типа распределения узлов:
1.  **Uniform (Равномерная):** Узлы равноудалены друг от друга.
    *   $\Lambda_n \sim 2^n$ (экспоненциальный рост).
2.  **Chebyshev (Чебышева):** Узлы сгущаются к краям отрезка. Корни полинома Чебышева, отображенные на $[a, b]$.
    *   *Преимущество:* Минимизирует $\max|\omega_n(x)|$, обеспечивая равномерную сходимость для гладких функций.
    *   $\Lambda_n \sim 1 + \frac{2}{\pi} log(n + 1)$ (медленный логарифмический рост).

### Расчет теоретической ошибки (`get_theoretical_error`)
Функция суммирует:
1.  **Truncation:**
    *   Вычисляется максимум узлового полинома `max_w` численным перебором.
    *   Производная берется аналитически: $max f^{(n)}(x) \approx 2^n \cosh(2b)$.
2.  **Rounding:**
    *   Вычисляется точная константа Лебега `const_lebegue` путем построения базисных полиномов на густой сетке и суммирования их модулей и поиском численного максимума.
    *   Умножается на $\varepsilon$ ($1.19 \cdot 10^{-7}$ для float, $2.22 \cdot 10^{-16}$ для double) и амплитуду функции.

## Анализ результатов

![Графики](/HW5/Task4/img/graphics.png)

### Равномерная сетка (Uniform)
*   **Truncation Error:** Сначала падает, но из-за феномена Рунге (степень полинома растёт, выражение для w_n вычисляется через последовательные вычитания очень близких чисел и из-за этого возникает потеря значащих цифр, и численная ошибка начинает нарастать сама по себе. Получается даже если аналитически ошибка убывает, при больших n машинная погрешность начинает доминировать, и итоговая ошибка растёт) быстро начинает расти.
*   **Rounding Error:** Константа Лебега растет как $2^N$. Это приводит к экспененциальному росту общей ошибки.
*   **Итог:** График имеет форму "галочки" (или резкого взлета). Интерполяция высокого порядка на равномерной сетке невозможна.

### Сетка Чебышева (Chebyshev)
*   **Truncation Error:** Убывает экспоненциально.
*   **Rounding Error:** Константа Лебега мала. Ошибка убывает до тех пор, пока не достигнет уровня, определяемого машинной точностью.
*   **Float vs Double:**
    *   Для `float` предел точности ($\approx 10^{-5} \dots 10^{-6}$) достигается очень быстро.
    *   Для `double` точность доходит до $\approx 10^{-14}$.

## Вывод
Эксперимент подтверждает теорию:
- Для интерполяции функций следует использовать **узлы Чебышева**, так как они гарантируют устойчивость и минимизацию ошибки метода.
- Равномерная сетка непригодна для интерполяции полиномами высоких степеней ($N > 10-15$) из-за неустойчивости (большой константы Лебега).
